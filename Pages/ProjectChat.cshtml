@page
@using Markdig
@model frontAIagent.Pages.ProjectChatModel
@{
    ViewData["Title"] = Model.Project.AnalysisName + " - AI Analysis";
}

<div class="container-fluid px-4 py-4">
    <!-- Уведомления вверху страницы -->
    @if (!string.IsNullOrEmpty(Model.SuccessMessage))
    {
        <div class="alert alert-success alert-dismissible fade show mb-4" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i>
            <strong>Success!</strong> @Model.SuccessMessage
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <strong>Error!</strong> @Model.ErrorMessage
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <div class="row g-4">
        <!-- Левая панель -->
        <div class="col-xl-4 col-lg-5 d-flex flex-column gap-4">
            <!-- Project Overview -->
            <div class="card project-card border-0 shadow-lg">
                <div class="card-header bg-gradient-primary text-white py-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-folder2-open fs-4 me-3"></i>
                        <div>
                            <h4 class="mb-0 fw-bold">Project Overview</h4>
                            <small class="opacity-75">@Model.Project.AnalysisName</small>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">
                    <div class="project-info-grid">
                        <div class="info-item">
                            <div class="info-icon bg-primary bg-opacity-10 text-primary">
                                <i class="bi bi-folder"></i>
                            </div>
                            <div class="info-content">
                                <label class="info-label">Directory</label>
                                <p class="info-value text-truncate" title="@Model.Project.DirectoryPath">@Model.Project.DirectoryPath</p>
                            </div>
                        </div>

                        <div class="info-item">
                            <div class="info-icon bg-info bg-opacity-10 text-info">
                                <i class="bi bi-filetype-@(Model.Project.FileType.Replace(".", ""))"></i>
                            </div>
                            <div class="info-content">
                                <label class="info-label">File Type</label>
                                <div class="info-value">
                                    <span class="tech-badge @GetFileTypeBadgeClass(Model.Project.FileType)">
                                        @Model.Project.FileType
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="info-item">
                            <div class="info-icon bg-warning bg-opacity-10 text-warning">
                                <i class="bi bi-clock-history"></i>
                            </div>
                            <div class="info-content">
                                <label class="info-label">Last Analyzed</label>
                                <p class="info-value">@Model.Project.LastAnalyzed.ToString("MMM dd, yyyy HH:mm")</p>
                            </div>
                        </div>

                        @if (!string.IsNullOrEmpty(Model.Project.LogPath))
                        {
                            <div class="info-item">
                                <div class="info-icon bg-success bg-opacity-10 text-success">
                                    <i class="bi bi-journal-text"></i>
                                </div>
                                <div class="info-content">
                                    <label class="info-label">Logs Directory</label>
                                    <p class="info-value text-truncate">@Model.Project.LogPath</p>
                                </div>
                            </div>
                        }

                        <div class="info-item full-width">
                            <div class="info-icon bg-secondary bg-opacity-10 text-secondary">
                                <i class="bi bi-card-text"></i>
                            </div>
                            <div class="info-content">
                                <label class="info-label">Description</label>
                                <p class="info-value description-text">@Model.Project.ProgramDescription</p>
                            </div>
                        </div>
                    </div>

                    <div class="d-grid mt-4">
                        <a href="/" class="btn btn-outline-primary btn-hover">
                            <i class="bi bi-arrow-left me-2"></i>Back to Projects
                        </a>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card border-0 shadow-lg">
                <div class="card-header bg-gradient-warning text-white py-3" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important;">
                    <h5 class="mb-0 d-flex align-items-center">
                        <i class="bi bi-lightning-charge-fill me-2"></i>
                        Quick Analysis
                    </h5>
                </div>
                <div class="card-body p-3">
                    <!-- Уведомления для быстрых действий -->
                    @if (!string.IsNullOrEmpty(TempData["QuickActionSuccess"] as string))
                    {
                        <div class="alert alert-info alert-dismissible fade show mb-3" role="alert">
                            <i class="bi bi-info-circle-fill me-2"></i>
                            @TempData["QuickActionSuccess"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    }

                    <div class="quick-actions-grid">
                        <button type="button" class="quick-action-btn" onclick="quickPrompt('Analyze code quality and suggest improvements')">
                            <div class="action-icon bg-primary bg-opacity-10 text-primary">
                                <i class="bi bi-graph-up"></i>
                            </div>
                            <span>Code Quality</span>
                        </button>

                        <button type="button" class="quick-action-btn" onclick="quickPrompt('Check for security vulnerabilities and best practices')">
                            <div class="action-icon bg-success bg-opacity-10 text-success">
                                <i class="bi bi-shield-check"></i>
                            </div>
                            <span>Security Scan</span>
                        </button>

                        <button type="button" class="quick-action-btn" onclick="quickPrompt('Optimize performance and identify bottlenecks')">
                            <div class="action-icon bg-warning bg-opacity-10 text-warning">
                                <i class="bi bi-speedometer2"></i>
                            </div>
                            <span>Performance</span>
                        </button>

                        <button type="button" class="quick-action-btn" onclick="quickPrompt('Review architecture and design patterns')">
                            <div class="action-icon bg-info bg-opacity-10 text-info">
                                <i class="bi bi-diagram-3"></i>
                            </div>
                            <span>Architecture</span>
                        </button>

                        <!-- Documentation button as POST -->
                        <form method="post" asp-page-handler="AskGptDocumentation" class="quick-action-btn p-0 m-0 border-0 bg-transparent">
                            <button type="submit" class="quick-action-btn w-100">
                                <div class="action-icon bg-secondary bg-opacity-10 text-secondary">
                                    <i class="bi bi-book"></i>
                                </div>
                                <span>Documentation</span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- File Statistics -->
            @if (Model.FileContext != null)
            {
                <div class="card border-0 shadow-lg">
                    <div class="card-header bg-gradient-info text-white py-3" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important;">
                        <h5 class="mb-0 d-flex align-items-center">
                            <i class="bi bi-pie-chart-fill me-2"></i>
                            File Statistics
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <!-- Уведомление о статусе файлов -->
                        @if (Model.FileContext.SuccessFiles == 0)
                        {
                            <div class="alert alert-warning mb-3" role="alert">
                                <i class="bi bi-exclamation-triangle me-2"></i>
                                No files were successfully read. Check directory permissions.
                            </div>
                        }
                        else if (Model.FileContext.FailedFiles > Model.FileContext.SuccessFiles)
                        {
                            <div class="alert alert-warning mb-3" role="alert">
                                <i class="bi bi-info-circle me-2"></i>
                                Many files failed to read. Some content may be missing.
                            </div>
                        }

                        <div class="stats-grid">
                            <div class="stat-item success">
                                <div class="stat-value">@Model.FileContext.SuccessFiles</div>
                                <div class="stat-label">Successful</div>
                                <div class="stat-icon">
                                    <i class="bi bi-check-circle-fill"></i>
                                </div>
                            </div>
                            <div class="stat-item total">
                                <div class="stat-value">@Model.FileContext.TotalFiles</div>
                                <div class="stat-label">Total Files</div>
                                <div class="stat-icon">
                                    <i class="bi bi-files"></i>
                                </div>
                            </div>
                            @if (Model.FileContext.FailedFiles > 0)
                            {
                                <div class="stat-item danger">
                                    <div class="stat-value">@Model.FileContext.FailedFiles</div>
                                    <div class="stat-label">Failed</div>
                                    <div class="stat-icon">
                                        <i class="bi bi-exclamation-circle-fill"></i>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>

        <!-- Правая панель -->
        <div class="col-xl-8 col-lg-7 d-flex flex-column gap-4">
            <!-- AI Chat Assistant -->
            <div class="card border-0 shadow-lg flex-grow-1 d-flex flex-column">
                <div class="card-header bg-gradient-success text-white py-3" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%) !important;">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-robot fs-4 me-3"></i>
                            <div>
                                <h4 class="mb-0 fw-bold">AI Analysis Assistant</h4>
                                <small class="opacity-75">Powered by GPT-4</small>
                            </div>
                        </div>
                        <div class="typing-indicator d-none">
                            <div class="typing-dots">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                            <small class="ms-2">AI is thinking...</small>
                        </div>
                    </div>
                </div>

                <div class="card-body d-flex flex-column p-0 flex-grow-1">
                    <!-- История чата -->
                    <div id="chatHistory" class="chat-messages flex-grow-1 p-4 overflow-auto">
                        @if (Model.ChatMessages.Any())
                        {
                            @foreach (var message in Model.ChatMessages)
                            {
                                <div class="message @(message.IsUser ? "user-message" : "ai-message")">
                                    <div class="message-avatar">
                                        @if (message.IsUser)
                                        {
                                            <div class="avatar bg-primary">
                                                <i class="bi bi-person-fill"></i>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="avatar bg-success">
                                                <i class="bi bi-robot"></i>
                                            </div>
                                        }
                                    </div>
                                    <div class="message-content">
                                        <div class="message-header">
                                            <strong>@(message.IsUser ? "You" : "AI Assistant")</strong>
                                            <small class="text-muted">@message.Timestamp.ToString("HH:mm")</small>
                                        </div>
                                        <div class="message-text">@message.Content</div>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="empty-chat-state text-center py-5">
                                <div class="empty-icon mb-3">
                                    <i class="bi bi-chat-left-dots-fill text-muted" style="font-size: 3rem;"></i>
                                </div>
                                <h5 class="text-muted mb-2">Start a Conversation</h5>
                                <p class="text-muted mb-4">Ask AI to analyze your project code, architecture, or suggest improvements</p>
                                <div class="suggestions">
                                    <button type="button" class="btn btn-outline-primary btn-sm me-2 mb-2" onclick="quickPrompt('What does this project do?')">
                                        What does this project do?
                                    </button>
                                    <button type="button" class="btn btn-outline-primary btn-sm me-2 mb-2" onclick="quickPrompt('Review the code structure')">
                                        Review code structure
                                    </button>
                                    <button type="button" class="btn btn-outline-primary btn-sm mb-2" onclick="quickPrompt('Suggest improvements')">
                                        Suggest improvements
                                    </button>
                                </div>
                            </div>
                        }
                    </div>

                    <!-- Форма ввода -->
                    <div class="chat-input-container p-4 border-top">
                        <!-- Уведомления для чата -->
                        @if (TempData["ChatError"] != null)
                        {
                            <div class="alert alert-warning alert-dismissible fade show mb-3" role="alert">
                                <i class="bi bi-chat-dots me-2"></i>
                                @TempData["ChatError"]
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        }

                        <form method="post" asp-page-handler="AskGpt" id="chatForm">
                            <input type="hidden" name="projectId" value="@Model.Project.Id" />
                            <div class="input-group input-group-lg">
                                <textarea class="form-control chat-input" name="userMessage" id="userMessage"
                                          rows="2" placeholder="Ask AI about your project..." required>@Model.UserMessage</textarea>
                                <button type="submit" class="btn btn-success btn-send" id="sendButton" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border: none;">
                                    <i class="bi bi-send-fill"></i>
                                </button>
                            </div>
                            <div class="form-text text-muted mt-2">
                                <i class="bi bi-info-circle me-1"></i>
                                Press Enter to send, Shift+Enter for new line
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Analysis Results -->
            @if (!string.IsNullOrEmpty(Model.AnalysisResult))
            {
                <div class="card border-0 shadow-lg">
                    <div class="card-header bg-gradient-info text-white py-3" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important;">
                        <h5 class="mb-0 d-flex align-items-center">
                            <i class="bi bi-file-earmark-text-fill me-2"></i>
                            Analysis Results
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <!-- Статус анализа -->
                        <div class="alert alert-success mb-3">
                            <i class="bi bi-check-circle-fill me-2"></i>
                            <strong>Analysis completed successfully!</strong> AI has processed your request.
                        </div>

                        <div class="analysis-result">
                            @Html.Raw(ConvertMarkdownToHtml(Model.AnalysisResult))
                        </div>
                    </div>
                </div>
            }
            else if (!string.IsNullOrEmpty(Model.ErrorMessage))
            {
                <div class="card border-0 shadow-lg">
                    <div class="card-header bg-gradient-danger text-white py-3" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%) !important;">
                        <h5 class="mb-0 d-flex align-items-center">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            Analysis Failed
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="alert alert-danger">
                            <i class="bi bi-x-circle-fill me-2"></i>
                            <strong>Analysis could not be completed:</strong> @Model.ErrorMessage
                        </div>
                        <p class="text-muted">Please try again or check your project configuration.</p>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@functions {
    private string GetFileTypeBadgeClass(string fileType)
    {
        return fileType.ToLower() switch
        {
            ".py" => "python-badge",
            ".cs" => "csharp-badge",
            ".js" => "javascript-badge",
            ".ts" => "typescript-badge",
            ".java" => "java-badge",
            _ => "default-badge"
        };
    }

    private string ConvertMarkdownToHtml(string markdown)
    {
        if (string.IsNullOrEmpty(markdown))
            return string.Empty;

        // Используем Markdig для качественной конвертации
        var pipeline = new Markdig.MarkdownPipelineBuilder().UseAdvancedExtensions().Build();
        return Markdig.Markdown.ToHtml(markdown, pipeline);
    }
}

@section Scripts {
    <script>
        function quickPrompt(promptText) {
            document.getElementById('userMessage').value = promptText;
            document.getElementById('userMessage').focus();

            // Показываем уведомление о быстром действии
            showQuickNotification('Quick action loaded: ' + promptText.substring(0, 50) + '...');
        }

        function showQuickNotification(message) {
            // Создаем временное уведомление
            const notification = document.createElement('div');
            notification.className = 'alert alert-info alert-dismissible fade show position-fixed top-0 end-0 m-3';
            notification.style.zIndex = '1060';
            notification.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            notification.style.color = 'white';
            notification.style.border = 'none';
            notification.innerHTML = `
                <i class="bi bi-lightning-fill me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(notification);

            // Автоматически скрываем через 3 секунды
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const chatHistory = document.getElementById('chatHistory');
            const chatForm = document.getElementById('chatForm');
            const sendButton = document.getElementById('sendButton');
            const userMessage = document.getElementById('userMessage');
            const typingIndicator = document.querySelector('.typing-indicator');

            // Автофокус и прокрутка
            userMessage.focus();
            chatHistory.scrollTop = chatHistory.scrollHeight;

            // Обработка отправки формы
            chatForm.addEventListener('submit', function(e) {
                const originalHTML = sendButton.innerHTML;

                // Показываем индикатор загрузки
                sendButton.innerHTML = '<i class="bi bi-hourglass-split"></i>';
                sendButton.disabled = true;
                typingIndicator.classList.remove('d-none');

                // Восстанавливаем кнопку через 30 секунд (на всякий случай)
                setTimeout(() => {
                    sendButton.innerHTML = originalHTML;
                    sendButton.disabled = false;
                    typingIndicator.classList.add('d-none');
                }, 30000);
            });

            // Авто-высота textarea
            userMessage.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });

            // Обработка клавиш (Enter для отправки, Shift+Enter для новой строки)
            userMessage.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    chatForm.requestSubmit();
                }
            });

            // Автоматически скрываем алерты через 5 секунд
            setTimeout(() => {
                const alerts = document.querySelectorAll('.alert');
                alerts.forEach(alert => {
                    if (alert.classList.contains('alert-dismissible')) {
                        const bsAlert = new bootstrap.Alert(alert);
                        bsAlert.close();
                    }
                });
            }, 5000);
        });
    </script>

    <style>
        /* Добавляем keyframes правильно */
        @@keyframes typing {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }

            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Красивые градиенты для всех карточек */
        .card-header.bg-gradient-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        }

        .card-header.bg-gradient-success {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%) !important;
        }

        .card-header.bg-gradient-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important;
        }

        .card-header.bg-gradient-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important;
        }

        .card-header.bg-gradient-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%) !important;
        }

        /* Остальные стили остаются без изменений */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --info-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --danger-gradient: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            --border-radius: 16px;
        }

        .project-card, .card {
            border-radius: var(--border-radius);
            border: none;
        }

        /* Project Info Grid */
        .project-info-grid {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .info-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 0.75rem;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

            .info-item:hover {
                background: rgba(0,0,0,0.02);
            }

            .info-item.full-width {
                grid-column: 1 / -1;
            }

        .info-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1.25rem;
        }

        .info-content {
            flex: 1;
            min-width: 0;
        }

        .info-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #6c757d;
            margin-bottom: 0.25rem;
        }

        .info-value {
            font-size: 0.95rem;
            color: #2c3e50;
            margin: 0;
            line-height: 1.4;
        }

        .description-text {
            line-height: 1.5;
        }

        /* Tech Badges */
        .tech-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: white !important;
        }

        .python-badge {
            background: linear-gradient(135deg, #3776ab, #ffde57);
            color: #000 !important;
        }

        .csharp-badge {
            background: linear-gradient(135deg, #239, #9b4993);
        }

        .javascript-badge {
            background: linear-gradient(135deg, #f7df1e, #000);
            color: #000 !important;
        }

        .typescript-badge {
            background: linear-gradient(135deg, #3178c6, #fff);
            color: #000 !important;
        }

        .java-badge {
            background: linear-gradient(135deg, #ed8b00, #5382a1);
        }

        .default-badge {
            background: linear-gradient(135deg, #6c757d, #495057);
        }

        /* Quick Actions */
        .quick-actions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem 0.5rem;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
            min-height: 80px;
        }

            .quick-action-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                border-color: #007bff;
            }

        .action-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            font-size: 1.25rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            border-radius: 12px;
            background: #f8f9fa;
            position: relative;
        }

            .stat-item.success {
                border-left: 4px solid #28a745;
            }

            .stat-item.total {
                border-left: 4px solid #007bff;
            }

            .stat-item.danger {
                border-left: 4px solid #dc3545;
            }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            color: #6c757d;
        }

        .stat-icon {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            opacity: 0.3;
        }

        /* Chat Styles */
        .chat-messages {
            background-color: #f8f9fa;
        }

        .message {
            display: flex;
            margin-bottom: 1.5rem;
        }

        .user-message {
            justify-content: flex-end;
        }

        .ai-message {
            justify-content: flex-start;
        }

        .message-avatar {
            margin: 0 1rem;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
        }

        .message-content {
            max-width: 70%;
            background: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .user-message .message-content {
            background: #007bff;
            color: white;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

            .message-header strong {
                font-size: 0.875rem;
            }

        .message-text {
            line-height: 1.5;
            white-space: pre-wrap;
        }

        /* Typing Indicator */
        .typing-dots {
            display: inline-flex;
            gap: 2px;
        }

            .typing-dots span {
                width: 6px;
                height: 6px;
                border-radius: 50%;
                background: currentColor;
                animation: typing 1.4s infinite ease-in-out;
            }

                .typing-dots span:nth-child(1) {
                    animation-delay: -0.32s;
                }

                .typing-dots span:nth-child(2) {
                    animation-delay: -0.16s;
                }

        /* Analysis Results */
        .analysis-result h1, .analysis-result h2, .analysis-result h3 {
            color: #2c3e50;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }

        .analysis-result h1 {
            font-size: 1.8rem;
            border-bottom: 2px solid #3498db;
            padding-bottom: 0.5rem;
        }

        .analysis-result h2 {
            font-size: 1.5rem;
            border-left: 4px solid #3498db;
            padding-left: 1rem;
        }

        .analysis-result h3 {
            font-size: 1.3rem;
            color: #2980b9;
        }

        .analysis-result pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 0.375rem;
            padding: 1rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .analysis-result code {
            background: #f8f9fa;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            font-family: 'Courier New', monospace;
        }

        .analysis-result ul, .analysis-result ol {
            padding-left: 2rem;
            margin: 1rem 0;
        }

        .analysis-result li {
            margin-bottom: 0.5rem;
            line-height: 1.5;
        }

        .analysis-result strong {
            color: #e74c3c;
            font-weight: 600;
        }

        .analysis-result em {
            color: #27ae60;
            font-style: italic;
        }

        /* Chat Input */
        .chat-input {
            border-radius: 12px;
            resize: none;
            border: 1px solid #e9ecef;
        }

        .btn-send {
            border-radius: 12px;
            margin-left: 0.5rem;
            border: none;
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        /* Empty State */
        .empty-chat-state {
            color: #6c757d;
        }

        .suggestions {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.5rem;
        }

        /* Дополнительные стили для уведомлений */
        .alert {
            border-radius: 12px;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .position-fixed {
            animation: slideInRight 0.3s ease-out;
        }

        @@keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
}